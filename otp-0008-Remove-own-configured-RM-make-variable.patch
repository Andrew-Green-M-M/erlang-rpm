From d9dd041acc211907b6cea4ae93f39c6319153d15 Mon Sep 17 00:00:00 2001
From: Rickard Green <rickard@erlang.org>
Date: Wed, 6 Mar 2019 17:55:41 +0100
Subject: [PATCH] Remove own configured RM make variable

Instead rely on gnu make's pre-defined RM variable which should
equal 'rm -f'
---
 erts/autoconf/vxworks/sed.general |  1 -
 erts/configure.in                 | 17 ++++++-----------
 erts/emulator/Makefile.in         | 15 +++++++--------
 erts/lib_src/Makefile.in          |  7 +++----
 lib/tools/c_src/Makefile.in       |  7 +++----
 make/otp.mk.in                    |  1 -
 system/doc/top/Makefile           | 14 +++++++-------
 7 files changed, 26 insertions(+), 36 deletions(-)

diff --git a/erts/autoconf/vxworks/sed.general b/erts/autoconf/vxworks/sed.general
index 0e99b4dba4..d32fbdc5c0 100644
--- a/erts/autoconf/vxworks/sed.general
+++ b/erts/autoconf/vxworks/sed.general
@@ -103,7 +103,6 @@ s|@INSTALL_PROGRAM@|${INSTALL}|
 s|@INSTALL_SCRIPT@|${INSTALL}|
 s|@INSTALL_DATA@|${INSTALL} -m 644|
 s|@INSTALL_DIR@|$(INSTALL) -d|
-s|@RM@|/bin/rm|
 s|@MKDIR@|/bin/mkdir|
 s|@ERLANG_OSTYPE@|vxworks|
 s|@vxworks_reclaim@|reclaim.h|
diff --git a/erts/configure.in b/erts/configure.in
index 53e8bd683a..35ae84e101 100644
--- a/erts/configure.in
+++ b/erts/configure.in
@@ -3288,14 +3288,14 @@ if test "$enable_dtrace_test" = "yes" ; then
 		AC_MSG_CHECKING([for 2-stage DTrace precompilation])
                 AC_TRY_COMPILE([ #include "foo-dtrace.h" ],
                     [ERLANG_DIST_PORT_BUSY_ENABLED();],
-		    [$RM -f $DTRACE_2STEP_TEST
+		    [rm -f $DTRACE_2STEP_TEST
 		     dtrace -G $DTRACE_CPP $DTRACE_BITS_FLAG -Iemulator/beam -o $DTRACE_2STEP_TEST -s emulator/beam/erlang_dtrace.d conftest.$OBJEXT 2>&AS_MESSAGE_LOG_FD
                      if test -f $DTRACE_2STEP_TEST; then
 			$RM $DTRACE_2STEP_TEST
                         DTRACE_ENABLED_2STEP=yes
 		     fi],
                     [])
-		$RM -f foo-dtrace.h
+		rm -f foo-dtrace.h
 		AS_IF([test "x$DTRACE_ENABLED_2STEP" = "xyes"],
 		      [AC_MSG_RESULT([yes])],
                       [AC_MSG_RESULT([no])])
@@ -3499,7 +3499,7 @@ ssl_done=yes # Default only one run
 
 # Remove all SKIP files from previous runs
 for a in ssl crypto ssh; do
-  $RM -f $ERL_TOP/lib/$a/SKIP
+  rm -f $ERL_TOP/lib/$a/SKIP
 done
 
 SSL_DYNAMIC_ONLY=$enable_dynamic_ssl
@@ -4120,7 +4120,7 @@ need_java="jinterface ic/java_src"
 
 # Remove all SKIP files from previous runs
 for a in $need_java ; do
-  $RM -f $ERL_TOP/lib/$a/SKIP
+  rm -f $ERL_TOP/lib/$a/SKIP
 done
 
 if test "X$with_javac" = "Xno"; then
@@ -4171,7 +4171,7 @@ dnl this deliberately does not believe that 'gcc' is a C++ compiler
 AC_CHECK_TOOLS(CXX, [$CCC c++ g++ CC cxx cc++ cl], false)
 
 # Remove SKIP file from previous run
-$RM -f $ERL_TOP/lib/orber/SKIP
+rm -f $ERL_TOP/lib/orber/SKIP
 
 if test "$CXX" = false; then
   echo "No C++ compiler found" > $ERL_TOP/lib/orber/SKIP
diff --git a/erts/emulator/Makefile.in b/erts/emulator/Makefile.in
index 57a9d45887..e7648f2396 100644
--- a/erts/emulator/Makefile.in
+++ b/erts/emulator/Makefile.in
@@ -266,7 +266,6 @@ DEXPORT = @DEXPORT@
 RANLIB  = @RANLIB@
 STRIP   = strip
 PERL    = @PERL@
-RM	= @RM@
 MKDIR	= @MKDIR@
 
 USING_MINGW=@MIXED_CYGWIN_MINGW@
@@ -467,13 +466,13 @@ $(ERTS_LIB):
 
 .PHONY: clean
 clean:
-	$(RM) -f $(GENERATE)
-	$(RM) -rf $(TARGET)/*.c $(TARGET)/*.h $(TARGET)/*-GENERATED
-	$(RM) -rf $(TARGET)/*/*
-	$(RM) -rf obj/$(TARGET)
-	$(RM) -rf pcre/obj/$(TARGET) $(PCRE_GENINC)
-	$(RM) -rf zlib/obj/$(TARGET)
-	$(RM) -rf bin/$(TARGET)
+	$(RM) $(GENERATE)
+	$(RM) -r $(TARGET)/*.c $(TARGET)/*.h $(TARGET)/*-GENERATED
+	$(RM) -r $(TARGET)/*/*
+	$(RM) -r obj/$(TARGET)
+	$(RM) -r pcre/obj/$(TARGET) $(PCRE_GENINC)
+	$(RM) -r zlib/obj/$(TARGET)
+	$(RM) -r bin/$(TARGET)
 	cd $(ERTS_LIB_DIR) && $(MAKE) clean
 
 .PHONY: docs
diff --git a/erts/lib_src/Makefile.in b/erts/lib_src/Makefile.in
index 8e1f5b58c4..1da11c2d0a 100644
--- a/erts/lib_src/Makefile.in
+++ b/erts/lib_src/Makefile.in
@@ -29,7 +29,6 @@ CC=@CC@
 LD=@LD@
 AR=@AR@
 RANLIB=@RANLIB@
-RM=@RM@
 MKDIR=@MKDIR@
 INSTALL=@INSTALL@
 INSTALL_DIR=@INSTALL_DIR@
@@ -536,9 +535,9 @@ release_docs_spec:
 #
 .PHONY: clean
 clean:
-	$(RM) -rf ../lib/internal/$(TARGET)/*
-	$(RM) -rf ../lib/$(TARGET)/*
-	$(RM) -rf obj/$(TARGET)/*
+	$(RM) -r ../lib/internal/$(TARGET)/*
+	$(RM) -r ../lib/$(TARGET)/*
+	$(RM) -r obj/$(TARGET)/*
 
 #
 # Make dependencies
diff --git a/lib/tools/c_src/Makefile.in b/lib/tools/c_src/Makefile.in
index cfe91917f8..289322b6fa 100644
--- a/lib/tools/c_src/Makefile.in
+++ b/lib/tools/c_src/Makefile.in
@@ -29,7 +29,6 @@ CC=@CC@
 LD=@LD@
 AR=@AR@
 RANLIB=@RANLIB@
-RM=@RM@
 MKDIR=@MKDIR@
 INSTALL=@INSTALL@
 INSTALL_DIR=@INSTALL_DIR@
@@ -158,9 +157,9 @@ $(ERTS_LIB):
 docs:
 
 clean:
-	$(RM) -rf ../obj/*
-	$(RM) -rf ../bin/*
-	$(RM) -f ./*~
+	$(RM) -r ../obj/*
+	$(RM) -r ../bin/*
+	$(RM) ./*~
 
 .PHONY: all erts_lib docs clean
 
diff --git a/make/otp.mk.in b/make/otp.mk.in
index fb573680c8..ceff8f7c31 100644
--- a/make/otp.mk.in
+++ b/make/otp.mk.in
@@ -274,7 +274,6 @@ DEFAULT_GIF_FILES = $(HTMLDIR)/min_head.gif
 XSLTPROC = @XSLTPROC@
 FOP = @FOP@
 XMLLINT = @XMLLINT@
-RM = @RM@
 CP = @CP@
 MKDIR = @MKDIR@
 
diff --git a/system/doc/top/Makefile b/system/doc/top/Makefile
index 2f50ff1905..3267bf96df 100644
--- a/system/doc/top/Makefile
+++ b/system/doc/top/Makefile
@@ -261,13 +261,13 @@ html:   $(INDEX_FILES) \
 debug opt: 
 
 clean:
-	$(RM) -f ../html/js/*.js
-	$(RM) -f PR.template
-	$(RM) -f $(XMLDIR)/*.xml
-	$(RM) -f $(INDEX_FILES) $(MAN_INDEX)
-	$(RM) -f $(TOP_PDF_FILE) $(TOP_PDF_FILE:%.pdf=%.fo)
-	$(RM) -f $(INDEX_SCRIPT) $(GLOSSARY_SCRIPT) $(JAVASCRIPT_BUILD_SCRIPT) 
-	$(RM) -f erl_crash.dump errs core *~
+	$(RM) ../html/js/*.js
+	$(RM) PR.template
+	$(RM) $(XMLDIR)/*.xml
+	$(RM) $(INDEX_FILES) $(MAN_INDEX)
+	$(RM) $(TOP_PDF_FILE) $(TOP_PDF_FILE:%.pdf=%.fo)
+	$(RM) $(INDEX_SCRIPT) $(GLOSSARY_SCRIPT) $(JAVASCRIPT_BUILD_SCRIPT) 
+	$(RM) erl_crash.dump errs core *~
 
 # ----------------------------------------------------
 # Release Target
@@ -291,7 +291,7 @@ release_docs_spec: docs
 	$(INSTALL_DATA) $(INDEX_SCRIPT) $(MAN_INDEX_SCRIPT) $(JAVASCRIPT_BUILD_SCRIPT) \
 		$(INDEX_SRC) $(MAN_INDEX_SRC) $(JAVASCRIPT_BUILD_SCRIPT_SRC) \
 		$(TEMPLATES) $(RELSYSDIR)/docbuild
-	$(RM) -rf $(RELSYSDIR)/temporary
+	$(RM) -r $(RELSYSDIR)/temporary
 
 
 release_spec:
-- 
2.20.1

