From d9dd041acc211907b6cea4ae93f39c6319153d15 Mon Sep 17 00:00:00 2001
From: Rickard Green <rickard@erlang.org>
Date: Wed, 6 Mar 2019 17:55:41 +0100
Subject: [PATCH] Remove own configured RM make variable

Instead rely on gnu make's pre-defined RM variable which should
equal 'rm -f'
---
 erts/autoconf/vxworks/sed.general |  1 -
 erts/configure.in                 | 17 ++++++-----------
 erts/emulator/Makefile.in         | 15 +++++++--------
 erts/lib_src/Makefile.in          |  7 +++----
 lib/tools/c_src/Makefile.in       |  7 +++----
 make/otp.mk.in                    |  1 -
 system/doc/top/Makefile           | 14 +++++++-------
 7 files changed, 26 insertions(+), 36 deletions(-)

diff --git a/erts/autoconf/vxworks/sed.general b/erts/autoconf/vxworks/sed.general
index efa4e99054..0638be12ed 100644
--- a/erts/autoconf/vxworks/sed.general
+++ b/erts/autoconf/vxworks/sed.general
@@ -99,7 +99,6 @@ s|@INSTALL_PROGRAM@|${INSTALL}|
 s|@INSTALL_SCRIPT@|${INSTALL}|
 s|@INSTALL_DATA@|${INSTALL} -m 644|
 s|@INSTALL_DIR@|$(INSTALL) -d|
-s|@RM@|/bin/rm|
 s|@MKDIR@|/bin/mkdir|
 s|@ERLANG_OSTYPE@|vxworks|
 s|@vxworks_reclaim@|reclaim.h|
diff --git a/erts/configure.in b/erts/configure.in
index c93ab85c4f..111d196390 100644
--- a/erts/configure.in
+++ b/erts/configure.in
@@ -62,7 +62,7 @@ fi
 erl_top=${ERL_TOP}
 
 # Remove old configuration information
-/bin/rm -f "$ERL_TOP/erts/CONF_INFO"
+rm -f "$ERL_TOP/erts/CONF_INFO"
 
 # echo XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
 # echo X
@@ -863,11 +863,6 @@ fi
 
 _search_path=/bin:/usr/bin:/usr/local/bin:$PATH
 
-AC_PATH_PROG(RM, rm, false, $_search_path)
-if test "$ac_cv_path_RM" = false; then
-  AC_MSG_ERROR([No 'rm' command found])
-fi
-
 AC_PATH_PROG(MKDIR, mkdir, false, $_search_path)
 if test "$ac_cv_path_MKDIR" = false; then
   AC_MSG_ERROR([No 'mkdir' command found])
@@ -3968,14 +3963,14 @@ if test "$enable_dtrace_test" = "yes" ; then
 		AC_MSG_CHECKING([for 2-stage DTrace precompilation])
                 AC_TRY_COMPILE([ #include "foo-dtrace.h" ],
                     [ERLANG_DIST_PORT_BUSY_ENABLED();],
-		    [$RM -f $DTRACE_2STEP_TEST
+		    [rm -f $DTRACE_2STEP_TEST
 		     dtrace -G $DTRACE_CPP $DTRACE_BITS_FLAG -Iemulator/beam -o $DTRACE_2STEP_TEST -s emulator/beam/erlang_dtrace.d conftest.$OBJEXT 2>&AS_MESSAGE_LOG_FD
                      if test -f $DTRACE_2STEP_TEST; then
 			rm $DTRACE_2STEP_TEST
                         DTRACE_ENABLED_2STEP=yes
 		     fi],
                     [])
-		$RM -f foo-dtrace.h
+		rm -f foo-dtrace.h
 		AS_IF([test "x$DTRACE_ENABLED_2STEP" = "xyes"],
 		      [AC_MSG_RESULT([yes])],
                       [AC_MSG_RESULT([no])])
@@ -4147,7 +4142,7 @@ ssl_done=yes # Default only one run
 
 # Remove all SKIP files from previous runs
 for a in ssl crypto ssh; do
-  /bin/rm -f $ERL_TOP/lib/$a/SKIP
+  rm -f $ERL_TOP/lib/$a/SKIP
 done
 
 SSL_DYNAMIC_ONLY=$enable_dynamic_ssl
@@ -4730,7 +4725,7 @@ need_java="jinterface ic/java_src"
 
 # Remove all SKIP files from previous runs
 for a in $need_java ; do
-  /bin/rm -f $ERL_TOP/lib/$a/SKIP
+  rm -f $ERL_TOP/lib/$a/SKIP
 done
 
 if test "X$with_javac" = "Xno"; then
@@ -4781,7 +4776,7 @@ dnl this deliberately does not believe that 'gcc' is a C++ compiler
 AC_CHECK_TOOLS(CXX, [$CCC c++ g++ CC cxx cc++ cl], false)
 
 # Remove SKIP file from previous run
-/bin/rm -f $ERL_TOP/lib/orber/SKIP
+rm -f $ERL_TOP/lib/orber/SKIP
 
 if test "$CXX" = false; then
   echo "No C++ compiler found" > $ERL_TOP/lib/orber/SKIP
diff --git a/erts/emulator/Makefile.in b/erts/emulator/Makefile.in
index 7145824f91..e892943c56 100644
--- a/erts/emulator/Makefile.in
+++ b/erts/emulator/Makefile.in
@@ -241,7 +241,6 @@ ifneq ($(findstring ose,$(TARGET)),ose)
 STRIP   = strip
 endif
 PERL    = @PERL@
-RM	= @RM@
 MKDIR	= @MKDIR@
 
 USING_MINGW=@MIXED_CYGWIN_MINGW@
@@ -441,13 +440,13 @@ $(ERTS_LIB):
 
 .PHONY: clean
 clean:
-	$(RM) -f $(GENERATE)
-	$(RM) -rf $(TARGET)/*.c $(TARGET)/*.h $(TARGET)/*-GENERATED
-	$(RM) -rf $(TARGET)/*/*
-	$(RM) -rf obj/$(TARGET)
-	$(RM) -rf pcre/obj/$(TARGET) $(PCRE_GENINC)
-	$(RM) -rf zlib/obj/$(TARGET)
-	$(RM) -rf bin/$(TARGET)
+	$(RM) $(GENERATE)
+	$(RM) -r $(TARGET)/*.c $(TARGET)/*.h $(TARGET)/*-GENERATED
+	$(RM) -r $(TARGET)/*/*
+	$(RM) -r obj/$(TARGET)
+	$(RM) -r pcre/obj/$(TARGET) $(PCRE_GENINC)
+	$(RM) -r zlib/obj/$(TARGET)
+	$(RM) -r bin/$(TARGET)
 	cd $(ERTS_LIB_DIR) && $(MAKE) clean
 
 .PHONY: docs
diff --git a/erts/lib_src/Makefile.in b/erts/lib_src/Makefile.in
index b680c03b1d..106e2dc983 100644
--- a/erts/lib_src/Makefile.in
+++ b/erts/lib_src/Makefile.in
@@ -28,7 +28,6 @@ CC=@CC@
 LD=@LD@
 AR=@AR@
 RANLIB=@RANLIB@
-RM=@RM@
 MKDIR=@MKDIR@
 INSTALL=@INSTALL@
 INSTALL_DIR=@INSTALL_DIR@
@@ -527,9 +526,9 @@ release_docs_spec:
 #
 .PHONY: clean
 clean:
-	$(RM) -rf ../lib/internal/$(TARGET)/*
-	$(RM) -rf ../lib/$(TARGET)/*
-	$(RM) -rf obj/$(TARGET)/*
+	$(RM) -r ../lib/internal/$(TARGET)/*
+	$(RM) -r ../lib/$(TARGET)/*
+	$(RM) -r obj/$(TARGET)/*
 
 #
 # Make dependencies
diff --git a/lib/tools/c_src/Makefile.in b/lib/tools/c_src/Makefile.in
index b1eb69f9dc..817d838054 100644
--- a/lib/tools/c_src/Makefile.in
+++ b/lib/tools/c_src/Makefile.in
@@ -28,7 +28,6 @@ CC=@CC@
 LD=@LD@
 AR=@AR@
 RANLIB=@RANLIB@
-RM=@RM@
 MKDIR=@MKDIR@
 INSTALL=@INSTALL@
 INSTALL_DIR=@INSTALL_DIR@
@@ -165,9 +164,9 @@ $(ERTS_LIB):
 docs:
 
 clean:
-	$(RM) -rf ../obj/*
-	$(RM) -rf ../bin/*
-	$(RM) -f ./*~
+	$(RM) -r ../obj/*
+	$(RM) -r ../bin/*
+	$(RM) ./*~
 
 .PHONY: all erts_lib docs clean
 
diff --git a/make/otp.mk.in b/make/otp.mk.in
index ddc9cd9b79..0ab17d9649 100644
--- a/make/otp.mk.in
+++ b/make/otp.mk.in
@@ -264,7 +264,6 @@ DEFAULT_GIF_FILES = $(HTMLDIR)/min_head.gif
 XSLTPROC = @XSLTPROC@
 FOP = @FOP@
 XMLLINT = @XMLLINT@
-RM = @RM@
 CP = @CP@
 MKDIR = @MKDIR@
 
diff --git a/system/doc/top/Makefile b/system/doc/top/Makefile
index 823ec18940..e4b2aca612 100644
--- a/system/doc/top/Makefile
+++ b/system/doc/top/Makefile
@@ -242,12 +242,12 @@ html:   $(INDEX_FILES) \
 debug opt: 
 
 clean:
-	$(RM) -f ../html/js/*.js
-	$(RM) -f PR.template 
-	$(RM) -f $(INDEX_FILES) $(MAN_INDEX)
-	$(RM) -f $(TOP_PDF_FILE) $(TOP_PDF_FILE:%.pdf=%.fo)
-	$(RM) -f $(INDEX_SCRIPT) $(GLOSSARY_SCRIPT) $(JAVASCRIPT_BUILD_SCRIPT) 
-	$(RM) -f erl_crash.dump errs core *~
+	$(RM) ../html/js/*.js
+	$(RM) PR.template 
+	$(RM) $(INDEX_FILES) $(MAN_INDEX)
+	$(RM) $(TOP_PDF_FILE) $(TOP_PDF_FILE:%.pdf=%.fo)
+	$(RM) $(INDEX_SCRIPT) $(GLOSSARY_SCRIPT) $(JAVASCRIPT_BUILD_SCRIPT) 
+	$(RM) erl_crash.dump errs core *~
 
 # ----------------------------------------------------
 # Release Target
@@ -271,7 +271,7 @@ release_docs_spec: docs
 	$(INSTALL_DATA) $(INDEX_SCRIPT) $(MAN_INDEX_SCRIPT) $(JAVASCRIPT_BUILD_SCRIPT) \
 		$(INDEX_SRC) $(MAN_INDEX_SRC) $(JAVASCRIPT_BUILD_SCRIPT_SRC) \
 		$(TEMPLATES) $(RELSYSDIR)/docbuild
-	$(RM) -rf $(RELSYSDIR)/temporary
+	$(RM) -r $(RELSYSDIR)/temporary
 
 
 release_spec:
-- 
2.20.1

